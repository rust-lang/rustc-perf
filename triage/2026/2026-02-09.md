# 2026-02-09 Triage Log

This week we saw quite a few improvements. Largest one comes from adding two targeted `with_capacity` calls in [#151929](https://github.com/rust-lang/rust/pull/151929).
Another source of multiple improvements is the ongoing migration away from using external files to store diagnostic messages.

Triage done by **@panstromek**.
Revision range: [a60d12cb..39219ceb](https://perf.rust-lang.org/?start=a60d12cbccfbeaf153f3cecb90454aa696ea4b3b&end=39219ceb97d1b37dda72517daa9ebe8364ffe186&absolute=false&stat=instructions%3Au)

**Summary**:

| (instructions:u)                   | mean  | range           | count |
|:----------------------------------:|:-----:|:---------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 2.0%  | [2.0%, 2.0%]    | 1     |
| Regressions ❌ <br /> (secondary)  | 0.6%  | [0.0%, 2.0%]    | 22    |
| Improvements ✅ <br /> (primary)   | -0.8% | [-2.8%, -0.2%]  | 179   |
| Improvements ✅ <br /> (secondary) | -3.1% | [-31.1%, -0.0%] | 211   |
| All ❌✅ (primary)                 | -0.7% | [-2.8%, 2.0%]   | 180   |


1 Regression, 6 Improvements, 7 Mixed; 9 of them in rollups
36 artifact comparisons made in total

#### Regressions

Pass on the `feedable` query modifier to macros [#151546](https://github.com/rust-lang/rust/pull/151546) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=1d05e3c131d7181eb3df1a8c261f43135c99200d&end=794495e2b4a1353cf7b66ffc55f0e755490af2cc&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.4%  | [0.2%, 0.9%]   | 20    |
| Regressions ❌ <br /> (secondary)  | 0.5%  | [0.0%, 1.0%]   | 47    |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.0% | [-0.0%, -0.0%] | 2     |
| All ❌✅ (primary)                 | 0.4%  | [0.2%, 0.9%]   | 20    |

Regressions coming from enabling assertions that were previously disabled by accident. Already triaged by @lqd.

#### Improvements

resolve: Use `IdentKey` in `resolve_ident_in_scope_set` [#151820](https://github.com/rust-lang/rust/pull/151820) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=a60d12cbccfbeaf153f3cecb90454aa696ea4b3b&end=f60a0f1bcc5a2a6dd8eb2d2021da79b40f5fbae9&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.3%, -0.2%] | 8     |
| Improvements ✅ <br /> (secondary) | -0.4% | [-0.9%, -0.1%] | 22    |
| All ❌✅ (primary)                 | -0.3% | [-0.3%, -0.2%] | 8     |


Use with_capacity in query_key_hash_verify and PlaceholderExpander [#151929](https://github.com/rust-lang/rust/pull/151929) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=366a1b93e7f466ebe559477add05f064873d0c71&end=0c40f5be0c8eb04d206e928c5d8c133a9142143a&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -0.6% | [-3.3%, -0.2%] | 166   |
| Improvements ✅ <br /> (secondary) | -0.9% | [-3.4%, -0.1%] | 161   |
| All ❌✅ (primary)                 | -0.6% | [-3.3%, -0.2%] | 166   |


Rollup of 12 pull requests [#152104](https://github.com/rust-lang/rust/pull/152104) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=930ecbcdf8905c5c8549056c73fcabdd8d6e1b3d&end=8bccf1224deab49b54694c9090e577bfe90a94e6&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.7% | [-1.5%, -0.2%] | 29    |
| All ❌✅ (primary)                 | -     | -              | 0     |


skip codegen for intrinsics with big fallback bodies if the backend does not need them [#150605](https://github.com/rust-lang/rust/pull/150605) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=8bccf1224deab49b54694c9090e577bfe90a94e6&end=db3e99bbab28c6ca778b13222becdea54533d908&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -1.3% | [-2.3%, -0.4%] | 2     |
| Improvements ✅ <br /> (secondary) | -     | -              | 0     |
| All ❌✅ (primary)                 | -1.3% | [-2.3%, -0.4%] | 2     |

Note: This PR addresses a regression from November.

Rollup of 9 pull requests [#152163](https://github.com/rust-lang/rust/pull/152163) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=0a13b4361264236cb40afebea97973e6dc366de3&end=66daca1a85c459b1da49dc0ef1ba027b53e4ac2c&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -1.3% | [-3.6%, -0.2%] | 38    |
| All ❌✅ (primary)                 | -     | -              | 0     |


Rollup of 13 pull requests [#152213](https://github.com/rust-lang/rust/pull/152213) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=cf16cd9b751f6e13caec393cef4f6f67de2f3da8&end=035b01b794602d5861daa43ac792f372f8981ed7&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.3%  | [0.3%, 0.3%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.2% | [-0.2%, -0.2%] | 1     |
| Improvements ✅ <br /> (secondary) | -1.8% | [-5.5%, -0.1%] | 42    |
| All ❌✅ (primary)                 | -0.2% | [-0.2%, -0.2%] | 1     |


#### Mixed

Rollup of 12 pull requests [#152063](https://github.com/rust-lang/rust/pull/152063) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=55407b8cdb1457c62e0c852f5b53a9cf63ec4e1b&end=366a1b93e7f466ebe559477add05f064873d0c71&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.3%  | [0.2%, 0.7%]   | 12    |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.4% | [-0.7%, -0.2%] | 14    |
| All ❌✅ (primary)                 | -     | -              | 0     |

Caused by https://github.com/rust-lang/rust/pull/151944. Already triaged by @JonathanBrouwer.

Rollup of 7 pull requests [#152075](https://github.com/rust-lang/rust/pull/152075) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=0c40f5be0c8eb04d206e928c5d8c133a9142143a&end=1d05e3c131d7181eb3df1a8c261f43135c99200d&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.8%  | [0.2%, 1.4%]   | 10    |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.3% | [-0.4%, -0.2%] | 15    |
| All ❌✅ (primary)                 | -     | -              | 0     |

Caused by https://github.com/rust-lang/rust/pull/148967. @JonathanBrouwer proposes to accept it in https://github.com/rust-lang/rust/pull/148967#issuecomment-3846276431.
The perf impact was assesed before the merge, final results are only slightly different from the last per-merge results.
All regressions are secondary stress tests, often related to CTFE.

Rollup of 18 pull requests [#152156](https://github.com/rust-lang/rust/pull/152156) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=9f4b56a5aed81e8c36cc26b3c1b4666ead6b71fc&end=0a13b4361264236cb40afebea97973e6dc366de3&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 1.1%  | [1.1%, 1.1%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.5%, -0.2%] | 9     |
| Improvements ✅ <br /> (secondary) | -1.8% | [-7.0%, -0.1%] | 64    |
| All ❌✅ (primary)                 | -0.3% | [-0.5%, -0.2%] | 9     |

Already triaged by @JonathanBrouwer. Improvements from inline diagnostics change. One regression in UCD is noise.

Rollup of 3 pull requests [#152239](https://github.com/rust-lang/rust/pull/152239) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=bce89b6a56fecd6f1a150c9657e4b50dea994f83&end=efc9e1b50cbf2cede7ebe25f0a1fc64fd8b3e942&stat=instructions:u)

| (instructions:u)                   | mean  | range           | count |
|:----------------------------------:|:-----:|:---------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -               | 0     |
| Regressions ❌ <br /> (secondary)  | 0.9%  | [0.5%, 1.4%]    | 9     |
| Improvements ✅ <br /> (primary)   | -     | -               | 0     |
| Improvements ✅ <br /> (secondary) | -4.7% | [-15.6%, -0.4%] | 32    |
| All ❌✅ (primary)                 | -     | -               | 0     |

Impact caused by https://github.com/rust-lang/rust/pull/152189, Improvements outweigh regressions. Already triaged by @JonathanBrouwer.

Rollup of 4 pull requests [#152264](https://github.com/rust-lang/rust/pull/152264) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=efc9e1b50cbf2cede7ebe25f0a1fc64fd8b3e942&end=c58d9f9f82ead734d73d99a64e910718f5f464d3&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.1%, 0.2%]   | 4     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -1.0% | [-3.2%, -0.4%] | 17    |
| All ❌✅ (primary)                 | -     | -              | 0     |

Already triaged by @JonathanBrouwer. Caused by inline diagnostics changes in https://github.com/rust-lang/rust/pull/152126 and https://github.com/rust-lang/rust/pull/152186.

Rollup of 7 pull requests [#152308](https://github.com/rust-lang/rust/pull/152308) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=c7f5f3e0d5defe632d44743cbaed56272e2b67f0&end=c69e1a04db484db8974904e6f8eb1e8df21a39ba&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.8%  | [0.4%, 1.1%]   | 12    |
| Regressions ❌ <br /> (secondary)  | 0.1%  | [0.0%, 0.1%]   | 2     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -2.1% | [-3.8%, -1.1%] | 4     |
| All ❌✅ (primary)                 | 0.8%  | [0.4%, 1.1%]   | 12    |

Caused by https://github.com/rust-lang/rust/pull/152217, already triaged by @JonathanBrouwer in https://github.com/rust-lang/rust/pull/152308#issuecomment-3867053365.

Another inline diagnostic migration change. Regressed benchmark generates a lot of diagnostics.
There's a plan to address regressions from this diagnostic migration later.

GVN: Only propagate borrows from SSA locals [#150485](https://github.com/rust-lang/rust/pull/150485) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=08a4ce529f4ea17ad1c0fa2e39ca1f5e7cd047b6&end=13c38730d981289cc7ae4cc109fd7756bf83ee67&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 1.0%  | [0.3%, 2.0%]   | 3     |
| Regressions ❌ <br /> (secondary)  | 0.7%  | [0.3%, 1.9%]   | 4     |
| Improvements ✅ <br /> (primary)   | -1.0% | [-1.0%, -1.0%] | 2     |
| Improvements ✅ <br /> (secondary) | -     | -              | 0     |
| All ❌✅ (primary)                 | 0.2%  | [-1.0%, 2.0%]  | 5     |


Results match pre-merge results, which was accepted in https://github.com/rust-lang/rust/pull/150485#issuecomment-3853373696.

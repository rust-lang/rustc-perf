# 2026-01-19 Triage Log

Various changes in both direction, but not much has changed overall.

Triage done by **@panstromek**.
Revision range: [840245e9..3d087e60](https://perf.rust-lang.org/?start=840245e91b90f22adf9f26d0a0cd98c2416cdef3&end=3d087e6044bddc65723bf42c76fe4cc33a0076b0&absolute=false&stat=instructions%3Au)

**Summary**:

| (instructions:u)                   | mean  | range           | count |
|:----------------------------------:|:-----:|:---------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.6%  | [0.1%, 1.6%]    | 21    |
| Regressions ❌ <br /> (secondary)  | 0.6%  | [0.0%, 2.6%]    | 113   |
| Improvements ✅ <br /> (primary)   | -0.3% | [-2.1%, -0.2%]  | 37    |
| Improvements ✅ <br /> (secondary) | -1.2% | [-29.6%, -0.1%] | 37    |
| All ❌✅ (primary)                 | 0.0%  | [-2.1%, 1.6%]   | 58    |


3 Regressions, 4 Improvements, 7 Mixed; 6 of them in rollups
40 artifact comparisons made in total

#### Regressions

Rollup of 13 pull requests [#151087](https://github.com/rust-lang/rust/pull/151087) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=fcac501a73cdde54de46a0683567f1a890730555&end=4931e09e3ac3182d2a00f38cccfdf68e8e385e1c&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -    | -            | 0     |
| Regressions ❌ <br /> (secondary)  | 0.3% | [0.1%, 0.4%] | 9     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | -    | -            | 0     |

I'm inclined to say this is mostly noise, but it's not 100% clear to me. Previous PR was explicit optimization, so while this looks it could be return to default state in some cases, it could also be a legit regression. Some of those numbers also improve in next rollup (https://github.com/rust-lang/rust/pull/151107).

If this is a regression, then I'd expect https://github.com/rust-lang/rust/pull/151017 to be the cause, as we've already seen a few regressions from attribute parsing rework and based on detailed results, regressions are mostly in frontend (parse_crate, HIR and such) and in frontend-focused benchmarks. I personally don't think we need to dig deeper into this, these are small stress tests and regressions are also small.

Rollup of 15 pull requests [#151144](https://github.com/rust-lang/rust/pull/151144) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=86a49fd71fecd25b0fd20247db0ba95eeceaba28&end=b6fdaf2a15736cbccf248b532f48e33179614d40&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -    | -            | 0     |
| Regressions ❌ <br /> (secondary)  | 1.3% | [0.5%, 2.1%] | 6     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | -    | -            | 0     |

Caused by https://github.com/rust-lang/rust/pull/150962, already triaged by @JonathanBrouwer. Discussion continues on the PR.

 Only use SSA locals in SimplifyComparisonIntegral [#150925](https://github.com/rust-lang/rust/pull/150925) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=22c74ba91873dd013479f86eac3e9ea10593bff9&end=18ae99075575810a158cc670dcc7579f1c2ca012&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3% | [0.2%, 0.4%] | 3     |
| Regressions ❌ <br /> (secondary)  | -    | -            | 0     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.3% | [0.2%, 0.4%] | 3     |

This fixes miscompilation regression, and the perf impact was measured and discussed before merge, so I assume this result is expected.

#### Improvements

Fix perf of `check_crate_level` refactor [#151015](https://github.com/rust-lang/rust/pull/151015) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=2850ca8295bc253186b291314ddc239632755475&end=fcac501a73cdde54de46a0683567f1a890730555&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.5% | [-0.9%, -0.1%] | 14    |
| All ❌✅ (primary)                 | -     | -              | 0     |


Rollup of 11 pull requests [#151107](https://github.com/rust-lang/rust/pull/151107) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=2fd6efc32704647e64d3d646d21c4c68eae100e4&end=8c52f735abd1af9a73941b78fe7ed2ab08b9c0dd&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.0%  | [0.0%, 0.0%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.2% | [-0.3%, -0.2%] | 4     |
| Improvements ✅ <br /> (secondary) | -0.2% | [-0.3%, -0.1%] | 7     |
| All ❌✅ (primary)                 | -0.2% | [-0.3%, -0.2%] | 4     |


resolve: In `visit_scopes` do not extract ctxt out of span unless necessary [#150982](https://github.com/rust-lang/rust/pull/150982) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=7704328ba5ae8d6ce0ac303c9d5a1a1605906766&end=b5c2a0fc0ac851e83ef943e3a2b90c1abab06baa&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.5%, -0.1%] | 59    |
| Improvements ✅ <br /> (secondary) | -0.4% | [-0.7%, -0.2%] | 27    |
| All ❌✅ (primary)                 | -0.3% | [-0.5%, -0.1%] | 59    |


rustdoc: Stop unconditionally evaluating the initializer of associated consts [#151232](https://github.com/rust-lang/rust/pull/151232) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=9f6cd6defbd7ef13f6777aa8e43b14d69f0a830a&end=fe98ddcfcfb6f185dbf4adeaf439d8a756da0273&stat=instructions:u)

| (instructions:u)                   | mean   | range           | count |
|:----------------------------------:|:------:|:---------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -      | -               | 0     |
| Regressions ❌ <br /> (secondary)  | -      | -               | 0     |
| Improvements ✅ <br /> (primary)   | -0.3%  | [-0.4%, -0.3%]  | 2     |
| Improvements ✅ <br /> (secondary) | -14.8% | [-29.6%, -0.0%] | 2     |
| All ❌✅ (primary)                 | -0.3%  | [-0.4%, -0.3%]  | 2     |


#### Mixed

Dogfood `-Zno-embed-metadata` in the standard library [#145343](https://github.com/rust-lang/rust/pull/145343) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=2f1bd3f3781c90a8447e37d65a898442b8618895&end=b2a322beb29110e22a1782e2ce5ed2a0719b81ed&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.9%  | [0.5%, 1.1%]   | 5     |
| Regressions ❌ <br /> (secondary)  | 0.3%  | [0.1%, 0.8%]   | 45    |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.3%, -0.2%] | 2     |
| Improvements ✅ <br /> (secondary) | -0.0% | [-0.0%, -0.0%] | 1     |
| All ❌✅ (primary)                 | 0.5%  | [-0.3%, 1.1%]  | 7     |

Triaged by @Kobzol: "The tiny regressions are only noticeable on the smallest crates, they are caused by now loading both the .rmeta and .rlib files of stdlib."

Rollup of 14 pull requests [#151051](https://github.com/rust-lang/rust/pull/151051) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=b2a322beb29110e22a1782e2ce5ed2a0719b81ed&end=db1484bdee1cb065b322a5bd512b39c49dadc9e5&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.1%  | [0.1%, 0.2%]   | 4     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.1%, 0.3%]   | 13    |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.2% | [-0.3%, -0.1%] | 2     |
| All ❌✅ (primary)                 | 0.1%  | [0.1%, 0.2%]   | 4     |

Caused by https://github.com/rust-lang/rust/pull/150934, already triaged by @JonathanBrouwer.

Explicitly export core and std macros [#139493](https://github.com/rust-lang/rust/pull/139493) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=db1484bdee1cb065b322a5bd512b39c49dadc9e5&end=9b81629631b382fd49ee3a20ac47797b1467e52d&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.5%  | [0.5%, 0.5%]   | 1     |
| Regressions ❌ <br /> (secondary)  | 0.1%  | [0.0%, 0.5%]   | 10    |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.1% | [-0.1%, -0.1%] | 2     |
| All ❌✅ (primary)                 | 0.5%  | [0.5%, 0.5%]   | 1     |

Pre-merge results (https://github.com/rust-lang/rust/pull/139493#issuecomment-3336171110) roughly match post-merge results, so I assume the regression is expected here. Some of this could also be noise, especially `include-blob`.

avoid phi node for pointers flowing into Vec appends [#130998](https://github.com/rust-lang/rust/pull/130998) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=8c52f735abd1af9a73941b78fe7ed2ab08b9c0dd&end=86a49fd71fecd25b0fd20247db0ba95eeceaba28&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.6%  | [0.1%, 1.2%]   | 10    |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.1%, 0.9%]   | 8     |
| Improvements ✅ <br /> (primary)   | -1.3% | [-2.7%, -0.5%] | 3     |
| Improvements ✅ <br /> (secondary) | -1.4% | [-4.3%, -0.3%] | 6     |
| All ❌✅ (primary)                 | 0.2%  | [-2.7%, 1.2%]  | 13    |

Some change like this was expected, but this was reverted for non-perf reasons, so I don't think we need to investigate further at the moment.

Rollup of 2 pull requests [#151151](https://github.com/rust-lang/rust/pull/151151) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=b6fdaf2a15736cbccf248b532f48e33179614d40&end=c9af9c1dc85a55e309345030ff9cb7ea247953fa&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 1.4%  | [0.6%, 2.8%]   | 3     |
| Regressions ❌ <br /> (secondary)  | 1.4%  | [0.3%, 4.5%]   | 6     |
| Improvements ✅ <br /> (primary)   | -0.7% | [-1.1%, -0.6%] | 6     |
| Improvements ✅ <br /> (secondary) | -0.2% | [-0.6%, -0.1%] | 5     |
| All ❌✅ (primary)                 | -0.0% | [-1.1%, 2.8%]  | 9     |

Revert of the previous PR, opposite effect. Quoting @Zalathar comment: "Perf changes appear to be the reverse of #130998 (comment), which is one of the PRs being reverted."

Rollup of 8 pull requests [#151291](https://github.com/rust-lang/rust/pull/151291) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=621d76794c76fc21c0a6151fbc090120e0230a91&end=ba2a7d33741a7ade4dc78e5e335d60d358cd1749&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3%  | [0.1%, 0.6%]   | 17    |
| Regressions ❌ <br /> (secondary)  | 0.5%  | [0.1%, 1.7%]   | 41    |
| Improvements ✅ <br /> (primary)   | -0.8% | [-2.3%, -0.2%] | 4     |
| Improvements ✅ <br /> (secondary) | -0.4% | [-2.1%, -0.2%] | 11    |
| All ❌✅ (primary)                 | 0.0%  | [-2.3%, 0.6%]  | 21    |

Caused by https://github.com/rust-lang/rust/pull/150955, which will be addressed in https://github.com/rust-lang/rust/pull/151376 and by https://github.com/rust-lang/rust/pull/148769, I'll continue discussion there.

New MIR Pass: SsaRangePropagation [#150309](https://github.com/rust-lang/rust/pull/150309) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=9b37157eceaa7c8ba4d6759335201a7dca58c2aa&end=3d087e6044bddc65723bf42c76fe4cc33a0076b0&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3%  | [0.2%, 0.4%]   | 4     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.2%, 0.3%]   | 2     |
| Improvements ✅ <br /> (primary)   | -0.4% | [-0.4%, -0.4%] | 1     |
| Improvements ✅ <br /> (secondary) | -     | -              | 0     |
| All ❌✅ (primary)                 | 0.2%  | [-0.4%, 0.4%]  | 5     |

pre-merge results roughly match the final results. Based on the assesment from https://github.com/rust-lang/rust/pull/150309#issuecomment-3718871578, I assume some small regressions in `opt` are expected.

Note that I can't asses very well whether this is justified or not as I don't have that much context. The original motivation for mir-opts was improving compile time, which is what I'm triaging here. From that standpoint this is now negative and it's only acceptable if it later leads to more improvements.

As far as I can tell, the motivation here is to improve runtime performance, for which we don't have much coverage in the benchmarks, so from that standpoint it's also not obvious to me whether this is worth the cost. Somebody with more knowledge than me should make that judgement.

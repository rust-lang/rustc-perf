# 2026-01-12 Triage Log

Fairly quiet week, most changes due to new features which naturally carry some
overhead for existing programs. Overall though an improvement.

Triage done by **@simulacrum**.
Revision range: [7c04f5d2..840245e9](https://perf.rust-lang.org/?start=7c04f5d216b5dcfff0a55fc20327a1c519004699&end=840245e91b90f22adf9f26d0a0cd98c2416cdef3&absolute=false&stat=instructions%3Au)

**Summary**:

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.5%  | [0.2%, 2.6%]   | 20    |
| Regressions ❌ <br /> (secondary)  | 0.4%  | [0.1%, 2.5%]   | 58    |
| Improvements ✅ <br /> (primary)   | -0.8% | [-6.6%, -0.2%] | 98    |
| Improvements ✅ <br /> (secondary) | -0.5% | [-1.8%, -0.1%] | 46    |
| All ❌✅ (primary)                 | -0.6% | [-6.6%, 2.6%]  | 118   |


3 Regressions, 1 Improvement, 4 Mixed; 2 of them in rollups
31 artifact comparisons made in total

#### Regressions

Rollup of 10 pull requests [#150726](https://github.com/rust-lang/rust/pull/150726) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=74fd7516dac6e7be0e561dddb9bee4e860598f07&end=4d73a008eaf6ba3ca067a3221e5c00602e33a5f2&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.4% | [0.2%, 0.8%] | 13    |
| Regressions ❌ <br /> (secondary)  | 0.2% | [0.1%, 0.3%] | 6     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.4% | [0.2%, 0.8%] | 13    |

This is due to "Impls and impl items inherit dead_code lint level of the
corresponding traits and trait items"
[#144113](https://github.com/rust-lang/rust/pull/144113) which adds a new
'feature' to the lint system and so is expected to carry some cost. The costs
look reasonable enough (small, only ~1 primary benchmark affected), so marking
as triaged.

Add allocator parameter to HashMap [#148545](https://github.com/rust-lang/rust/pull/148545) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=4586feb998521343b91c554adbb11ba30547d67a&end=31cd367b9ca1ce359268e7adf4ea540408c0ad85&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3% | [0.2%, 0.5%] | 3     |
| Regressions ❌ <br /> (secondary)  | 0.5% | [0.5%, 0.5%] | 1     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.3% | [0.2%, 0.5%] | 3     |

Expected to cause regressions (actually surprised it's so few). Marked as triaged.

Rollup of 14 pull requests [#150957](https://github.com/rust-lang/rust/pull/150957) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=08f833aa179952037d5d0c5d949d4c3ec18ec212&end=1279939b38db460bd3844a6ca44e94961a48333d&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.1% | [0.1%, 0.2%] | 4     |
| Regressions ❌ <br /> (secondary)  | 0.4% | [0.1%, 1.0%] | 20    |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.1% | [0.1%, 0.2%] | 4     |

Kicked off [perf runs](https://github.com/rust-lang/rust/pull/150957#issuecomment-3738810175) on
component PRs to investigate root cause. If it is related to attribute parsing
it's likely these regressions should just be accepted though.

#### Improvements

resolve: Use `Macros20NormalizedIdent` in more interfaces [#150741](https://github.com/rust-lang/rust/pull/150741) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=7c41ee66db9d08e3989858acaefa1c72a6a88518&end=b68e16cfc0e9f8b29c9ec41bfa6ab0a637eff19c&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.6%  | [0.6%, 0.6%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.6%, -0.1%] | 114   |
| Improvements ✅ <br /> (secondary) | -0.4% | [-1.2%, -0.1%] | 63    |
| All ❌✅ (primary)                 | -0.3% | [-0.6%, -0.1%] | 114   |


#### Mixed

`Vec::push` in consts MVP [#147893](https://github.com/rust-lang/rust/pull/147893) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=da476f1942868cdf94ed88b01ea31170cfe95047&end=74fd7516dac6e7be0e561dddb9bee4e860598f07&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3%  | [0.3%, 0.4%]   | 3     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.1%, 0.4%]   | 5     |
| Improvements ✅ <br /> (primary)   | -0.2% | [-0.2%, -0.2%] | 1     |
| Improvements ✅ <br /> (secondary) | -1.8% | [-1.9%, -1.7%] | 2     |
| All ❌✅ (primary)                 | 0.2%  | [-0.2%, 0.4%]  | 4     |

Looking at a cranelift profile it loosely looks like we're spending more time
in LLVM, maybe because of the extra indirection though the `const_eval_select`?
Though I don't see obvious signs of this in godbolt diffs vs beta.

In either case, marking as triaged as further investigation doesn't seem
warranted given magnitude and general desire for this feature.

Port `#[cfg]` and `#[cfg_attr]` trace attributes to the new attribute parsers  [#150310](https://github.com/rust-lang/rust/pull/150310) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=0aced202c24f9356c1640fc0a7f07433b3a7124f&end=d9617c8d9a55773a96b61ba3a4acb107d65615c1&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3%  | [0.2%, 0.6%]   | 5     |
| Regressions ❌ <br /> (secondary)  | 0.1%  | [0.1%, 0.1%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.4%, -0.1%] | 13    |
| Improvements ✅ <br /> (secondary) | -0.2% | [-0.3%, -0.1%] | 11    |
| All ❌✅ (primary)                 | -0.1% | [-0.4%, 0.6%]  | 18    |

Expected regressions from attribute parsing rework. Marking as triaged. This
also shrunk crate metadata a good bit, e.g., [2% on `syn`](https://perf.rust-lang.org/compare.html?start=0aced202c24f9356c1640fc0a7f07433b3a7124f&end=d9617c8d9a55773a96b61ba3a4acb107d65615c1&stat=size:crate_metadata).

Stop emitting UbChecks on every Vec→Slice [#150265](https://github.com/rust-lang/rust/pull/150265) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=3fda0e426ca17b0baa0d6e765a0d23f487350573&end=85d0cdfe3489ff1a4b86daeddba6fcf82b47bd65&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 1.3%  | [0.1%, 2.6%]   | 3     |
| Regressions ❌ <br /> (secondary)  | 2.5%  | [2.5%, 2.5%]   | 1     |
| Improvements ✅ <br /> (primary)   | -1.5% | [-5.8%, -0.1%] | 25    |
| Improvements ✅ <br /> (secondary) | -0.5% | [-1.4%, -0.1%] | 6     |
| All ❌✅ (primary)                 | -1.2% | [-5.8%, 2.6%]  | 28    |

Mixed results but overall an improvement.

Also hash spans inside the same file as relative (V2) [#150540](https://github.com/rust-lang/rust/pull/150540) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=9bc8b40bc314b74e1d5e5ab21a0df39c55a34806&end=08f833aa179952037d5d0c5d949d4c3ec18ec212&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.3%  | [0.1%, 0.4%]   | 6     |
| Regressions ❌ <br /> (secondary)  | 0.3%  | [0.1%, 0.7%]   | 27    |
| Improvements ✅ <br /> (primary)   | -1.2% | [-6.5%, -0.2%] | 20    |
| Improvements ✅ <br /> (secondary) | -0.3% | [-0.5%, -0.2%] | 8     |
| All ❌✅ (primary)                 | -0.9% | [-6.5%, 0.4%]  | 26    |

See [author's note here](https://github.com/rust-lang/rust/pull/150540#issuecomment-3734528974):

> Matches the expected performance, net positive
